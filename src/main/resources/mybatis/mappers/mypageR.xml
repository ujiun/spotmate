<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mypageR">


	<!-- car정보 등록 -->
	<insert id="myDriverinsert" parameterType="dlvo">

		<selectKey keyProperty="carNo" resultType="int"
			order="BEFORE">
			select seq_car_no.nextval from dual
		</selectKey>
		
		<![CDATA[
		
			insert into car
			values(
			    #{carNo},
			    #{userNo},
			    #{c_Model},
			    #{c_file},
			    #{c_num},
			    #{c_color},
			    #{num_PA},
			    #{introduce}
			) 
	
		]]>

	</insert>


	<!-- 카등록시 회원정보업데이트 -->
	<update id="myDriverUpdate" parameterType="dlvo">
	<![CDATA[
		update  users
	 	set 
	 		licenseNo = #{dl},
	 		licenseType = #{licensetype}
	 	where no = #{userNo}
		]]>
	</update>



	<!-- 카 옵션등록 -->
	<insert id="carDetailInsert" parameterType="map">
		<![CDATA[
		
			insert into carDetail
			values(
			    seq_carDetail_no.nextval,
			    (select no from car where userno = #{userNo}),
			    #{detailNo}
			) 
	
		]]>

	</insert>


	<select id="getCarInfo" parameterType="int" resultType="dlvo">
		<![CDATA[
			select  c.no AS carNo,
					c.userNo,
					c.carName AS c_Model,
			        c.carNo as c_num,
			        c.carColor AS c_color,
			        c.people as num_PA,
			        c.introduce,
			        u.name as username,
			        u.birth as userBD,
			        u.licenseNo AS dl,
			        u.licenseType
			from users u, car c
			where u.no = c.userno
			and u.no = #{userNo}
			order by c.no desc
			              
		]]>
	</select>
	
	
	<!-- 유저정보수정 -->
	<update id="userUpdate" parameterType="dlvo">
	<![CDATA[
		update  users
	 	set 
	 		name = #{username},
	 		birth = #{userBD},
	 		licenseNo = #{dl},
	 		licenseType = #{licensetype}
	 	where no = #{userNo}
		]]>
	</update>
	
	<!-- 유저정보수정 -->
	<update id="carUpdate" parameterType="dlvo">
	<![CDATA[
		update  car
	 	set 
	 		carname = #{c_Model},
	 		carno = #{c_num},
	 		carpicture = #{c_file},
	 		carcolor = #{c_color},
	 		people = #{num_PA},
	 		introduce = #{introduce}
	 	where userno = #{userNo}
		]]>
	</update>
	
	<update id="carDetailDelete" parameterType="dlvo">
	<![CDATA[
		delete from cardetail
	 	where carno = (select no from car where userno = #{userNo})
		]]>
	</update>
	
	
</mapper>
